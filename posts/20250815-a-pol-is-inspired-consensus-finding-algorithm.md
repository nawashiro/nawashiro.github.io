---
title: "pol.is にインスピレーションを受けた合意検出アルゴリズムについて"
date: "2025-08-15T15:12:42+09:00"
---
## TOC

# Nawashiro — pol.is にインスピレーションを受けた合意検出アルゴリズムについて

## 1. 概要

本文書は、pol.is にインスピレーションを受けた参加者グループ内での合意領域と代表的意見を特定する合意検出アルゴリズムの分析を提示するものである。本アルゴリズムは次元削減、クラスタリング、統計的仮説検定を組み合わせ、疎な投票データから合意パターンの抽出を試みる。

## 2. システム概観

合意アルゴリズムは統合された分析パイプラインとして動作する。

### 2.1 データ処理フローの適応性

アルゴリズムは参加者と意見のペアで構成される疎な投票データを基礎として開始する。各投票は賛成（+1）、反対（-1）、棄権（0）で表現される。システムはデータの特性を動的に評価し、最適な処理経路を選択する。

次元削減の段階では、データ密度 50% を閾値として、密データに対しては PCA を、疎データに対しては SVD フォールバックを適用する。

クラスタリングにおいては、Calinski-Harabasz Index を使用して最適なクラスタ数を決定する。統計検定では、Mehta & Patel（1983）による Network Algorithm を使用して Fisher 正確確率検定の近似を実行する。

### 2.2 統計的信頼性の強化

システムは多重比較問題に対する制御を実装している。FDR 制御では、Benjamini-Hochberg 法を採用し、複数検定による第 I 種過誤の累積を統計的に許容可能な水準（α=0.05）に制限している。適応的推論においては、Jeffreys 事前分布 Beta(0.5,0.5) を用いた客観的ベイジアン推論により、事前知識の影響を最小化している。検定力保証として、各クラスタが最低限の統計的有意性を維持できるよう、動的なサイズ制御を実装している。

## 3. 統計的方法論

このアルゴリズムは三つの主要な方法論コンポーネントによって構成されている。第一は、SVD フォールバック機構を持つ PCA による次元削減である。第二は、Calinski-Harabasz Index 最適化による K-means クラスタリングである。第三は、Mehta & Patel（1983）の Network Algorithm を用いた Fisher 正確確率検定の近似である。

アルゴリズムは二種類のスコアを算出する。合意スコアは複数のクラスタにわたって共通する見解を特定し、Jeffreys 事前分布による確率積で計算される。代表性スコアは特定のクラスタ内において代表的な見解を特定し、Network Algorithm と mid-P 値アプローチを組み合わせた統計検定に基づく。

### 3.1 次元削減と疎データ処理

初期段階では、高次元の参加者 - 意見行列をクラスタリング分析に適した低次元表現に変換するために PCA を使用する。アルゴリズムは、非ゼロ要素の総行列要素に対する比率を計算することでデータ密度を監視する。データ欠損率が 50% を超え、すべての可能な参加者 - 意見組み合わせの半分以上が未投票であることを示す場合、システムは自動的に SVD ベースの次元削減に切り替える。

SVD フォールバック機構は疎行列の数学的特性を活用し、データカバレッジが不完全であっても SVD 分解が潜在因子を特定できる。アルゴリズムは最大特異値に対応する左特異ベクトルを抽出し、データギャップにも関わらず参加者合意の主要パターンを効果的に捉える。この適応的アプローチは、様々なデータ密度条件にわたる堅牢な性能を保証する。

### 3.2 クラスタリングとグループ識別

K-means クラスタリングは次元削減された参加者表現で動作し、自然な意見グループを特定する。アルゴリズムは、Calinski-Harabasz Index（CHI）を通じて最適なクラスタ数を決定する。CHI は以下の式で定義される：

$$\text{CHI} = \frac{\text{BCSS}/(k-1)}{\text{WCSS}/(n-k)}$$

ここで、BCSS は Between-Cluster Sum of Squares（クラスタ間分散）、WCSS は Within-Cluster Sum of Squares（クラスタ内分散）、k はクラスタ数、n はデータ点数である。より高い CHI 値がより良いクラスタリングを示す。

クラスタ数は 2 から $\min(10, 2 + \lfloor n/12 \rfloor)$ の範囲で、$n$ は参加者数である。この制約により、統計的に意味のあるグループサイズを維持し、後続の統計検定における十分な検定力を確保している。

### 3.3 合意スコアリングと Jeffreys 事前分布による平滑化

グループ認識合意検出は、特定されたクラスタ内での合意確率を推定するためにベイジアンアプローチを使用する。各意見 - グループ組み合わせについて、アルゴリズムは Jeffreys 事前分布 $\text{Beta}(0.5, 0.5)$ を採用し、合意確率を $P(\text{賛成}) = \frac{A + 0.5}{S + 1}$ で計算する。ここで A は賛成票数を、S はグループ内の非棄権票の総数を表す。

Jeffreys 事前分布の採用は、変換不変性とフィッシャー情報行列に基づく客観的推論を提供する。この選択により、事前知識の影響を最小化し、データ駆動型の推定を実現している。疑似カウント（賛成 0.5、反対 0.5）は、小標本における極端な確率推定を適切に制御し、境界値（0, 1）での数値的安定性を保証する。

各意見の最終合意スコアは、すべての特定されたグループにわたる合意確率の積を表す。この乗法的アプローチは、意見が単一グループ内での圧倒的支持ではなく、多様な参加者クラスタにわたって広範な支持を示す場合のみ高い合意スコアを達成することを保証する。

### 3.4 統計検定と FDR 制御

代表的コメント識別では、Network Algorithm (Mehta & Patel, 1983) と mid-P 値アプローチを組み合わせた手法を採用している。この特定の組み合わせの利点として、Network Algorithm は従来の Fisher 正確検定における階乗計算による計算爆発を防ぎ、大規模データでの実行可能性を確保する。mid-P 値アプローチは Fisher 正確検定の過度な保守性を緩和し、連続分布に近い検定力を提供する。両者の組み合わせにより、計算効率性と統計的妥当性の両立を実現している。

#### 3.4.1 Network Algorithm による効率的確率計算

Network Algorithm は Fisher 正確確率検定の計算効率化を目的として開発された手法である。この手法により、従来の階乗計算で生じるオーバーフローを回避し、2×2 分割表の確率分布を効率的に算出することができる。

まず範囲最適化として、可能な分割表構成の範囲を $\min(a) = \max(0, k_1 - n_2)$、$\max(a) = \min(n_1, k_1)$ で制限する。

次に対数空間計算において、超幾何分布の確率を対数空間で計算することで数値オーバーフローを防止する。最後に効率的累積では、観測値以下の確率を効率的に累積し、正確な p 値を算出する。

#### 3.4.2 mid-P 値アプローチによる保守性緩和

従来の Fisher 正確検定の過度な保守性を緩和するため、mid-P 値アプローチを適用している。

この手法では以下の式により p 値を計算する：

$$\text{mid-P} = P(X < X_{\text{observed}}) + 0.5 \times P(X = X_{\text{observed}})$$

このアプローチにより、離散分布特有の保守的バイアスを軽減し、連続分布における検定力により近い性能を実現している。

### 3.5 多重比較補正による信頼性制御

統計的信頼性を確保するため、Benjamini-Hochberg 法による偽発見率（FDR）制御を実装している。全てのクラスタ × 投稿 × 投票タイプの組み合わせで p 値を収集し、昇順ソート後、各検定の rank i に対して $p_{\text{adj}}(i) = \min(1, \frac{n}{\text{rank}} \times p_i)$ を計算する。単調性保持により、前の調整済み p 値以下に制約する。

デフォルトの FDR 閾値 α = 0.05 を適用し、調整済み p 値がこの閾値未満の場合のみ統計的有意と判定する。この多重比較補正により、複数検定による第 I 種過誤の累積を厳格に制御し、偽陽性発見を統計的に許容可能な水準に抑制している。

代表性スコアは合意率の生の差と統計的信頼度を組み合わせる：代表性 = $(p_{\text{group}} - p_{\text{other}}) \times (1 - p_{\text{adj}})$。この定式化により、多重比較補正後も統計的に有意かつ実質的な差異を示す意見のみが高い代表性スコアを獲得する。

---

# 査読者 A — 査読コメント

対象原稿: 「pol.is にインスピレーションを受けた合意検出アルゴリズム」

## 0) 要旨（2–4 文）

本稿は疎な賛否/棄権データに対し、PCA/SVD→k-means（Calinski–Harabasz）→Fisher（Network Algorithm + mid-P）→BH で FDR 制御というパイプラインにより、クラスタ横断の「合意」とクラスタ内の「代表性」を定量化する設計を述べる。発想自体は有用だが、棄権の生成過程（MNAR）の未同定、k-means 仮定と距離の適合性、k 選択の安定性、クラスタ選択後の同一データによる検定（事後選択バイアス）、mid-P の誤差制御、合意スコアの積型定義の独立性仮定とクラスタ数依存性、FDR の依存構造、代表性スコアの解釈など、統計的健全性に関わる論点が多い。総じて大幅改訂（Major Revision）を推奨する。

## 1) 総合判定

**判定**: Major Revision  
**主理由（上位 3 件）**:

1. **欠測/棄権の統計モデルが未特定**で、MNAR（意見の強さ/立場と棄権の相関）下で推定・検定が歪む可能性が高い。
2. **クラスタリング → 同一データで検定**という設計は、クラスタ発見という「選択」に条件づけた p 値の偏り（選択的推測）を生む。サンプルスプリット等が必要。
3. **合意スコアの定義（全クラスタ賛成確率の積）** は独立性仮定とクラスタ数依存が強く、尺度の解釈性と頑健性に課題。階層ベイズ等の代替が望ましい。

## 2) Major Comments（採否に関わる論点）

### MC-1 欠測/棄権の生成過程（MNAR）と推定・検定の歪み

**指摘**: 棄権（0）を単なる未観測/中立とみなす明示的な統計モデルがなく、MNAR（例: 強い反対派が棄権しやすい等）の下で賛成率推定と群間比較が系統的に偏る懸念。  
**なぜ重要か**: 合意推定と代表性検定の両方が**有効標本の選択**に依存する。MNAR では Jeffreys 事前での平滑化だけでは系統誤差を補えない。  
**提案**: (a) 3 値応答の**多項ロジット**（agree/disagree/abstain）でクラスタ効果を持つ階層モデル、(b) **二段階選択モデル**（回答確率 → 回答内容）または**パターン混合/選択モデル**、(c) **多重代入**（棄権の傾向スコアで重み付け）を比較。MNAR 感度分析（楽観/悲観シナリオ）を追加。  
**検証**: シミュレーションで MNAR の強度 × スパース率に対する合意/代表性のバイアスと型 I/II 誤りを評価。

### MC-2 距離・前処理と k-means の仮定不整合

**指摘**: k-means は等分散等方的クラスタを仮定し、**符号付き疎行列由来の低次元埋め込みに必ずしも整合しない**。また PCA/SVD は**連続ガウス誤差**を暗黙に仮定。  
**提案**: (a) **ロジスティック PCA**/バイナリ行列表現（GLM-PCA）、(b) **対応分析（CA）**や**サイン付きグラフのスペクトラル埋め込み**、(c) クラスタリングは**k-medoids/GMM/スペクトラル/混合ベルヌーイ**等と比較。  
**検証**: 距離関数（コサイン/ジューカード/サイン付きラプラシアン）× クラスタ法の**安定性（ブートストラップ・Jaccard）** と外的妥当性を提示。

### MC-3 k 選択を Calinski–Harabasz（CHI）に限定する妥当性

**指摘**: CHI は**小標本/クラスタ形状歪み**に脆弱で、上界 k が「2 + floor(n/12)」等のヒューリスティックに依存。  
**提案**: **Gap 統計**、**安定性ベース**、**GMM の BIC**、**シルエット係数**（代替指標）や**層別 CH**を併用し、合意指標の頑健性を k に対して報告。  
**検証**: 合意/代表性ランキングの**k 感度曲線**（k=2..Kmax）を公開。

### MC-4 事後選択バイアス（クラスタ発見 → 同一データで検定）

**指摘**: クラスタはデータ駆動で選ばれており、同じデータで代表性の有意性検定を行うと**選択条件付き**の p 値が必要。  
**提案**: **サンプルスプリット/クロスフィッティング**（Fold A でクラスタ、Fold B で検定）、もしくは**選択的推測**の枠組み（post-selection inference）や**パラメトリックブートストラップ**。  
**検証**: シミュレーションで名目 α に対する実効型 I 誤りを提示。

### MC-5 mid-P 値の使用と型 I 誤り

**指摘**: mid-P は保守性を緩和するが、**実効 α が名目を上回る**可能性がある。  
**提案**: **Boschloo/Barnard/無条件検定**や**正規近似 +Newcombe 区間**と比較。mid-P を使うなら**実測家族内誤差率**/FDR の制御状況をシミュレーションで提示。

### MC-6 合意スコアの積型定義と独立性・クラスタ数依存

**指摘**: 「全クラスタ賛成確率の積」は**独立性仮定**を置く上、**クラスタ数が増えるほど不当に低下**しやすい。  
**提案**: **階層ベイズ**（ベースライン θ ＋クラスタ効果 δ_c）、**異質性指標**（τ² や Cochran’s Q 類似）、あるいは**下限保証**（min_c P_c(agree)）や**幾何平均**、**サイズ重み**付き集約。**“全クラスタが θ>θ₀”の事後確率**を直接評価する方法も有望。  
**検証**: クラスタ数・サイズ不均衡・スパース率に対する**スコア安定性**を図示。

### MC-7 FDR（BH）の依存構造前提と重み付け

**指摘**: BH の理論保証は PRDS 等の**依存構造**を仮定。クラスタ間でテストが強く依存する可能性が高い。  
**提案**: **BY**（保守的）や**IHW（独立仮説重み付け）**、**層別 BH**（アイテム内で階層化）を検討。FDR 実効値を**再標本化**で推定し併記。

### MC-8 代表性スコア（差 ×(1−p_adj)）の解釈性と恣意性

**指摘**: 効果量と p の混合は**解釈が難しく再現性が低い**。  
**提案**: **効果量（差/オッズ比/ロジスティック回帰係数）**と**不確実性（CI/事後区間）**を分離し、ランキングは**効果量の Shrinkage 推定**（例: Empirical Bayes）で行う。

### MC-9 50% 密度閾値と PCA/SVD 切替の根拠

**指摘**: 50% は**恣意的**。PCA と SVD は数値的には近縁で、疎行列では**欠測機構**の方が重要。  
**提案**: **行列補完/確率的 SVD/因子分析**、**MF（Poisson/Bernoulli）**や**協調フィルタリング**を比較。閾値は**性能曲線**で経験的に示す。

### MC-10 評価指標と外部妥当性

**指摘**: 内的指標に偏重。  
**提案**: **時系列分割**（t で学習 →t+1 で再現）、**外部ラベル**や**再掲投票の一致率**、**ブートストラップ再現率**を提示。

### MC-11 公平性・少数意見の扱い

**指摘**: 広範支持を重視する定義は**少数派の一貫した支持**を見落とす可能性。  
**提案**: **多目的指標**（広範支持と強度/一貫性の Pareto フロント）、**小規模クラスタの保護的最小重み**を導入。

### MC-12 再現性・計算報告

**指摘**: 乱数、実装、収束、計算量、停止条件の**報告テンプレ**が必要。  
**提案**: 付録に**擬似コード/バージョン/乱数シード/計算時間/メモリ**を明記。

## 3) Minor Comments（編集・明確化）

- 合意/代表性の**数式定義**を明示（すべての記号の定義、指数/ログ領域の実装詳細）。
- 棄権の扱い（**除外 or 0 処理**）を一貫化し、両者の差分を補遺に掲載。
- CHI 式の**分母分子の推定量**（不偏/標本）を明記。
- Network Algorithm は**厳密/近似/数値安定化**のどのバリアントか、**擬似コード**と対数空間計算の詳細を提示。
- BH の**単調性強制**の実装と、調整 p の**同順位処理**を明記。
- 図中のエラーバーは**95%CI**か**HDI**かを明示。
- 変数名と指標名の衝突（p, P, π など）を回避。
- 参考文献に**ロジスティック PCA/GLM-PCA、IHW、選択的推測**の主要論文を追加。

## 4) 追加実験・解析の具体案（著者がすぐ回せる形）

1. **MNAR 感度分析**: 棄権生成をロジットで制御（回答確率=logit^{-1}(α + β·立場)）。β∈{0,0.5,1.0}でバイアスと合意順位変動を報告。
2. **距離 × クラスタ法アブレーション**: {cosine, signed-Laplacian, Jaccard} × {k-means, k-medoids, spectral, GMM}の安定性（100 ブート）。
3. **k 感度曲線**: k=2..Kmax で合意 Top-10 の**Jaccard 一致率**。
4. **選択バイアス検証**: 2 分割クロスフィットで代表性の**実効 α**を推定。
5. **合意スコア代替**: 階層ベイズ（θ ~ Beta(a,b), δ_c ~ Normal(0,τ²)）で「∀c: θ_c>θ₀」の事後確率を算出し、現行スコアと順位相関を比較。
6. **FDR の依存感度**: BH, BY, IHW で偽発見率を再標本化で推定。

## 5) シルエット係数の代替案（著者が比較に入れやすい指標）

- **Gap 統計**、**Davies–Bouldin 指数**、**Dunn 指数**、**BIC（GMM）**、**安定性ベース**（サブサンプリング一致率）、**相互情報量**（コクラスタリング）。

## 6) 再現性チェックリスト

- データ: 前処理（重複/ボット/重み/時間窓）・欠測定義・棄権規則
- 埋め込み: 手法/次元/正則化/スケーリング
- クラスタ: 初期化/反復/停止/乱数/実行回数
- k 選択: 指標/範囲/上限根拠/感度解析
- 検定: 2×2 表の定義/片両側/連続性補正/近似精度
- 多重比較: 手法/層別/重み/実効 FDR 推定
- 報告: 図表コード/シード/計算資源と時間

## 7) まとめ（建設的提案）

- 棄権/MNAR を明示的にモデル化し、距離とクラスタ法を疎・符号データに整合的に。
- k 選択と合意スコア定義の**感度/安定性**を可視化。
- 代表性検定は**事後選択**を回避（スプリット/選択的推測）。
- mid-P と FDR 依存性の**実証**を補い、効果量中心の解釈へ。

これらの修正により、実運用での信頼性と説得力が大きく向上する。
