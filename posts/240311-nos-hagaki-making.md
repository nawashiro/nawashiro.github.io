---
title: ハッカソンでバーチャルな文通ができるNostrクライアント「NosHagaki」を作ってみた
date: 2024-03-11
---
よくきたな。俺は逆噴射なわしろだ。俺は普段ものすごい量の文章を書いているが、誰にも読ませるつもりはない。
嘘です。普段文章なんか書かないし、書いたとしても大部分をインターネットで世界中に公開しています。どうも、なわしろです。
今回、VRコミュニティのエンジニア集会で催されたハッカソンに参加しました。このテキストはそのレポートです。
## イベントについて
### VRコミュニティ エンジニア集会とは？
<ruby>慕狼<rp>(</rp><rt>しのがみ</rt><rp>)</rp></ruby>家の末っ子、慕狼ゆにさんが、いくつかのVRプラットフォームで運営している集会です。エンジニアならハード・ソフト・その他何でもOK、金曜日にお酒を飲んでワイワイしよう、というゆるい集会です｡毎回「進捗共有会」が催されます。飲んだお酒を進捗に数えてもOKです。話が長くて制限時間を超えると、床が抜けて落とされます。
VRChatで開催する週とClusterで開催する週があります。よくある誤解なのですが、これらのソフトはVR機器が無くても、デスクトップで使えます。特にClusterはスマホからでも入れるので、敷居はかなり低いです。
### テーマ「バーチャルな〇〇」第一回エンジニア集会ハッカソン
最初の開催ということで、テーマは応募前から開示されていました。テーマは上記の通り、バーチャルと関係していれば何でもOKということで、参加者は仮想マシンを作ったり、きゅうりに蜂蜜をかけてメロンの味を再現しようとしたり、面白い試みを色々やっていました。
バーチャルライフマガジンの取材もあったとのことですので、そちらのアクセスカウンターも回していただけると幸いです。
## NosHagakiについて

https://nos-hagaki.vercel.app/

### 構想
「距離が離れていて時間がかかる文通アプリ」というアイデアはスマホアプリ「Slowly」の影響を受けています。これを分散型SNSでできないか、というのを去年から考えていました。
本格的に作り始めたのは今年の始め頃からです。そう、今年の初め頃なのです。後からハッカソンの募集を見かけ、テーマにバーチャルをこじつけました。

当初から相互運用性のある分散型SNSプロトコルを使用したいと考えていました。最初はActivityPubでできないか模索していました。しかし、ActivityPubでサーバーを立てるというのは、そのまま一つのSNSを発足させることを意味します。やることが…やることが多い…！ここでNostrを使えばセンシティブなデータを扱わなくて済むというkaijiさんのブログを読み、こちらでの実装を決意しました。

https://zenn.dev/kaiji/articles/e855dccba73211

住所は公開鍵をシードに乱数を生成して作成します。しかし、陸地のみを指定したくて、どうすればいいだろうと悩みました。陸地を細かく区分けして地域として扱うとか色々考えましたが、最終的にとんでもなく頭がよくて素晴らしい方法に辿り着きました。

> 「陸地を当てるまでサイコロを振り続ければいいじゃない！」
> 	なわしろ

多分一番愚かな方法だと思います。マイニングかな？

陸地かどうか判定するために、容量とライセンスがいい感じのgeojsonを拾ってきました。これで地域名が取得できたら陸地と考えます。すみかに日本語の地域名が、消印にISO 3166-1の国名コードが表示されます。
海岸線がOpenStreetMapと比較して誤差を含むようですが、目を瞑りました。何も見えません。あと、北方領土がロシアだったりします。各国の主張には目を瞑りました。何も見えません。
さて、住所が扱えるようになり、すると距離とかかる日数もわかるはずなので、あとは予約投稿のような仕組みがあれば完成しそうです。
### 使用した技術
フレームワークはNext.jsを採用しました。慣れていたし、フルスタックアプリを作るには都合が良さそうだったからです。それに、デプロイ先として無料プランのあるVercelが使えます。
すると、使えるDBはVercel側で用意されたものになります。Postgres、KV（Redis）です。
言語はTypeScriptです。静的型付けができた方が楽なのかな、という軽い気持ちで決めました。
肝心のNostrライブラリですが、NDKというのが使いやすそうでした。